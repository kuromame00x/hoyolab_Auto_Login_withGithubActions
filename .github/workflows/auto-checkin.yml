name: Auto Hoyolab Check-in

on:
  schedule:
    - cron: '0 16 * * *'  # 毎日01:00 JST（=16:00 UTC）
  workflow_dispatch:

jobs:
  checkin:
    runs-on: ubuntu-latest
    env:
      ENDFIELD_CRED: ${{ secrets.ENDFIELD_CRED }}
      ENDFIELD_SK_GAME_ROLE: ${{ secrets.ENDFIELD_SK_GAME_ROLE }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirement.txt

      - name: Create .env from repository secrets
        run: |
          mkdir -p src
          {
            echo "LTUID=${{ secrets.LTUID }}"
            echo "LTOKEN=${{ secrets.LTOKEN }}"
            echo "COOKIE_TOKEN_V2=${{ secrets.COOKIE_TOKEN_V2 }}"
          } > src/.env

      - name: Run checkin script
        working-directory: src
        run: python checkin.py

      - name: Endfield daily check-in
        if: ${{ env.ENDFIELD_CRED != '' && env.ENDFIELD_SK_GAME_ROLE != '' }}
        run: |
          python src/endfield_checkin.py

